FF                                                                       [100%]
=================================== FAILURES ===================================
_____________________ test_shorten_and_redirect_and_stats ______________________

    def test_shorten_and_redirect_and_stats():
>       client = get_client()

tests/test_app.py:16: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_app.py:7: in get_client
    tmpdir = tempfile.TemporaryDirectory()
/usr/local/lib/python3.11/tempfile.py:871: in __init__
    self.name = mkdtemp(suffix, prefix, dir)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

suffix = '', prefix = 'tmp', dir = '/tmp'

    def mkdtemp(suffix=None, prefix=None, dir=None):
        """User-callable function to create and return a unique temporary
        directory.  The return value is the pathname of the directory.
    
        Arguments are as for mkstemp, except that the 'text' argument is
        not accepted.
    
        The directory is readable, writable, and searchable only by the
        creating user.
    
        Caller is responsible for deleting the directory when done with it.
        """
    
        prefix, suffix, dir, output_type = _sanitize_params(prefix, suffix, dir)
    
        names = _get_candidate_names()
        if output_type is bytes:
            names = map(_os.fsencode, names)
    
        for seq in range(TMP_MAX):
            name = next(names)
            file = _os.path.join(dir, prefix + name + suffix)
            _sys.audit("tempfile.mkdtemp", file)
            try:
>               _os.mkdir(file, 0o700)
E               OSError: [Errno 28] No space left on device: '/tmp/tmpa_k_sorj'

/usr/local/lib/python3.11/tempfile.py:385: OSError
_______________________________ test_qr_endpoint _______________________________

    def test_qr_endpoint():
>       client = get_client()

tests/test_app.py:40: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_app.py:7: in get_client
    tmpdir = tempfile.TemporaryDirectory()
/usr/local/lib/python3.11/tempfile.py:871: in __init__
    self.name = mkdtemp(suffix, prefix, dir)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

suffix = '', prefix = 'tmp', dir = '/tmp'

    def mkdtemp(suffix=None, prefix=None, dir=None):
        """User-callable function to create and return a unique temporary
        directory.  The return value is the pathname of the directory.
    
        Arguments are as for mkstemp, except that the 'text' argument is
        not accepted.
    
        The directory is readable, writable, and searchable only by the
        creating user.
    
        Caller is responsible for deleting the directory when done with it.
        """
    
        prefix, suffix, dir, output_type = _sanitize_params(prefix, suffix, dir)
    
        names = _get_candidate_names()
        if output_type is bytes:
            names = map(_os.fsencode, names)
    
        for seq in range(TMP_MAX):
            name = next(names)
            file = _os.path.join(dir, prefix + name + suffix)
            _sys.audit("tempfile.mkdtemp", file)
            try:
>               _os.mkdir(file, 0o700)
E               OSError: [Errno 28] No space left on device: '/tmp/tmp_a87z8d5'

/usr/local/lib/python3.11/tempfile.py:385: OSError
=============================== warnings summary ===============================
../usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12
  /usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_app.py::test_shorten_and_redirect_and_stats - OSError: [Err...
FAILED tests/test_app.py::test_qr_endpoint - OSError: [Errno 28] No space lef...
FF                                                                       [100%]
=================================== FAILURES ===================================
_____________________ test_shorten_and_redirect_and_stats ______________________

    def test_shorten_and_redirect_and_stats():
>       client = get_client()

tests/test_app.py:16: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    def get_client():
        tmpdir = tempfile.TemporaryDirectory()
        os.environ["DB_PATH"] = os.path.join(tmpdir.name, "test.db")
>       from src.app import app  # import after setting DB_PATH
E       ModuleNotFoundError: No module named 'src'

tests/test_app.py:9: ModuleNotFoundError
_______________________________ test_qr_endpoint _______________________________

    def test_qr_endpoint():
>       client = get_client()

tests/test_app.py:40: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    def get_client():
        tmpdir = tempfile.TemporaryDirectory()
        os.environ["DB_PATH"] = os.path.join(tmpdir.name, "test.db")
>       from src.app import app  # import after setting DB_PATH
E       ModuleNotFoundError: No module named 'src'

tests/test_app.py:9: ModuleNotFoundError
=============================== warnings summary ===============================
../usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12
  /usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_app.py::test_shorten_and_redirect_and_stats - ModuleNotFoun...
FAILED tests/test_app.py::test_qr_endpoint - ModuleNotFoundError: No module n...
F.                                                                       [100%]
=================================== FAILURES ===================================
_____________________ test_shorten_and_redirect_and_stats ______________________

    def test_shorten_and_redirect_and_stats():
        app = get_app()
        with TestClient(app) as client:
            # shorten
            r = client.post("/api/shorten", json={"url": "https://example.com"})
            assert r.status_code == 200, r.text
            data = r.json()
            code = data["code"]
    
            # redirect
            r2 = client.get(f"/{code}", allow_redirects=False)
            assert r2.status_code == 307
>           assert r2.headers["location"] == "https://example.com"
E           AssertionError: assert 'https://example.com/' == 'https://example.com'
E             
E             - https://example.com
E             + https://example.com/
E             ?                    +

tests/test_app.py:26: AssertionError
=============================== warnings summary ===============================
../usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12
  /usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

tests/test_app.py::test_shorten_and_redirect_and_stats
  /app/src/app.py:32: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

tests/test_app.py::test_shorten_and_redirect_and_stats
  /usr/local/lib/python3.11/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/test_app.py::test_shorten_and_redirect_and_stats
  /usr/local/lib/python3.11/site-packages/starlette/testclient.py:484: DeprecationWarning: The `allow_redirects` argument is deprecated. Use `follow_redirects` instead.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_app.py::test_shorten_and_redirect_and_stats - AssertionErro...
1 failed, 1 passed, 4 warnings in 0.42s
F.                                                                       [100%]
=================================== FAILURES ===================================
_____________________ test_shorten_and_redirect_and_stats ______________________

    def test_shorten_and_redirect_and_stats():
        app = get_app()
        with TestClient(app) as client:
            # shorten
            r = client.post("/api/shorten", json={"url": "https://example.com"})
            assert r.status_code == 200, r.text
            data = r.json()
            code = data["code"]
    
            # redirect
            r2 = client.get(f"/{code}", allow_redirects=False)
            assert r2.status_code == 307
            assert r2.headers["location"].rstrip("/") == "https://example.com"
    
            # stats
            r3 = client.get(f"/api/{code}/stats")
            assert r3.status_code == 200
            stats = r3.json()
            assert stats["total_clicks"] >= 1
            assert stats["code"] == code
>           assert stats["long_url"] == "https://example.com"
E           AssertionError: assert 'https://example.com/' == 'https://example.com'
E             
E             - https://example.com
E             + https://example.com/
E             ?                    +

tests/test_app.py:34: AssertionError
=============================== warnings summary ===============================
../usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12
  /usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

tests/test_app.py::test_shorten_and_redirect_and_stats
  /app/src/app.py:32: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

tests/test_app.py::test_shorten_and_redirect_and_stats
  /usr/local/lib/python3.11/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/test_app.py::test_shorten_and_redirect_and_stats
  /usr/local/lib/python3.11/site-packages/starlette/testclient.py:484: DeprecationWarning: The `allow_redirects` argument is deprecated. Use `follow_redirects` instead.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_app.py::test_shorten_and_redirect_and_stats - AssertionErro...
1 failed, 1 passed, 4 warnings in 0.40s
..                                                                       [100%]
=============================== warnings summary ===============================
../usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12
  /usr/local/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

tests/test_app.py::test_shorten_and_redirect_and_stats
  /app/src/app.py:32: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

tests/test_app.py::test_shorten_and_redirect_and_stats
  /usr/local/lib/python3.11/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

tests/test_app.py::test_shorten_and_redirect_and_stats
  /usr/local/lib/python3.11/site-packages/starlette/testclient.py:484: DeprecationWarning: The `allow_redirects` argument is deprecated. Use `follow_redirects` instead.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2 passed, 4 warnings in 0.37s
